{% extends "bookstore/base.html" %}
{% block content %}
<h2>è´­ç‰©è½¦</h2>

{% if customer %}
  <p><strong>å½“å‰ä¼šå‘˜ç­‰çº§ï¼š{{ customer.levelid.levelid }}çº§</strong></p>
  <p>æŠ˜æ‰£ç‡ï¼š{{ discount_percent|floatformat:0 }}% æŠ˜æ‰£ï¼ˆ{{ discount_rate|floatformat:2 }}æŠ˜ï¼‰</p>
{% endif %}

<table border="1" cellpadding="10" style="width: 100%; border-collapse: collapse;">
  <thead>
    <tr>
      <th>å›¾ä¹¦</th>
      <th>æ•°é‡</th>
      <th>å•ä»·</th>
      <th>åŸå§‹å°è®¡</th>
      <th>æŠ˜æ‰£åå°è®¡</th>
      <th>æ“ä½œ</th>
    </tr>
  </thead>
  <tbody>
    {% for item in items %}
      <tr>
        <td>{{ item.book.title }}</td>
        <td>
          <form method="post" action="{% url 'bookstore:cart_update' item.book.isbn %}" style="display: flex; gap: 0.5rem; align-items: center;">
            {% csrf_token %}
            <input type="number" name="quantity" value="{{ item.quantity }}" min="0" max="{{ item.book.stockqty }}"
                   style="width: 70px; padding: 0.3rem; border: 1px solid #ddd; border-radius: 4px;">
            <button type="submit" class="btn" style="padding: 0.3rem 0.8rem; font-size: 0.9rem;">æ›´æ–°</button>
          </form>
        </td>
        <td>Â¥{{ item.book.price }}</td>
        <td>Â¥{{ item.original_amount|floatformat:2 }}</td>
        <td><strong>Â¥{{ item.discounted_amount|floatformat:2 }}</strong></td>
        <td>
          <a href="{% url 'bookstore:cart_remove' item.book.isbn %}" 
             onclick="return confirm('ç¡®å®šè¦ç§»é™¤ã€Š{{ item.book.title }}ã€‹å—ï¼Ÿ')"
             style="color: #e74c3c; text-decoration: none;">
            ğŸ—‘ï¸ ç§»é™¤
          </a>
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="6">è´­ç‰©è½¦ä¸ºç©º</td>
      </tr>
    {% endfor %}
  </tbody>
  <tfoot>
    <tr>
      <td colspan="3"><strong>åˆè®¡</strong></td>
      <td>Â¥{{ original_total|floatformat:2 }}</td>
      <td><strong>Â¥{{ discounted_total|floatformat:2 }}</strong></td>
      <td></td>
    </tr>
    <tr>
      <td colspan="3"><strong>èŠ‚çœé‡‘é¢</strong></td>
      <td colspan="3" style="color: green;"><strong>Â¥{{ discount_amount|floatformat:2 }}</strong></td>
    </tr>
  </tfoot>
</table>

{% if items %}
  <p style="margin-top: 20px;">
    <a href="{% url 'bookstore:order_confirm' %}" style="padding: 10px 20px; background-color: #007bff; color: white; text-decoration: none; border-radius: 5px;">å»ç»“ç®—</a>
  </p>
{% endif %}
{% endblock %}