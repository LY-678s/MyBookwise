{% extends "bookstore/base.html" %}
{% block content %}
<div class="container animate-fade-in">
    <div style="text-align: center; margin-bottom: 2rem;">
        <h1 style="font-weight: 400; color: var(--text-primary);">ğŸ›’ è´­ç‰©è½¦</h1>
        <p style="color: var(--text-secondary);">ç¡®è®¤å•†å“å¹¶å‰å¾€ç»“ç®—</p>
    </div>

    <div class="card" style="margin-bottom: 1.5rem;">
        <div class="card-body">
            {% if items %}
            <div style="overflow-x: auto;">
                <table style="width:100%; border-collapse: collapse;">
                    <thead style="background: var(--secondary-bg);">
                        <tr>
                            <th style="padding: 1rem; text-align: left;">å›¾ä¹¦</th>
                            <th style="padding: 1rem; text-align: center;">æ•°é‡</th>
                            <th style="padding: 1rem; text-align: center;">å•ä»·</th>
                            <th style="padding: 1rem; text-align: center;">å°è®¡</th>
                            <th style="padding: 1rem; text-align: center;">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in items %}
                        <tr style="border-bottom: 1px solid var(--border);">
                            <td style="padding: 1rem;">
                                <div style="display:flex; gap:1rem; align-items:center;">
                                    <div style="width:60px; height:90px; background:var(--accent-light); border-radius:6px; overflow:hidden; flex-shrink:0;">
                                        {% if item.book.coverimage %}
                                        <img src="data:image/jpeg;base64,{{ item.book.coverimage|safe }}" alt="{{ item.book.title }}" style="width:100%; height:100%; object-fit:cover;">
                                        {% else %}
                                        <div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; font-size:1.5rem;">ğŸ“–</div>
                                        {% endif %}
                                    </div>
                                    <div>
                                        <div style="font-weight:600; color:var(--text-primary);">{{ item.book.title }}</div>
                                        <div style="color:var(--text-secondary); font-size:0.9rem;">ISBN: {{ item.book.isbn }}</div>
                                    </div>
                                </div>
                            </td>
                            <td style="padding:1rem; text-align:center;">
                                <form method="post" action="{% url 'bookstore:cart_update' item.book.isbn %}" style="display:flex; gap:0.5rem; justify-content:center; align-items:center;">
                                    {% csrf_token %}
                                    <input type="number" name="quantity" value="{{ item.quantity }}" min="0" max="{{ item.book.stockqty }}" class="form-control" style="width:80px; text-align:center;">
                                    <button type="submit" class="btn btn-secondary" style="padding:0.4rem 0.8rem;">æ›´æ–°</button>
                                </form>
                            </td>
                            <td style="padding:1rem; text-align:center; color:var(--text-secondary);">Â¥{{ item.book.price }}</td>
                            <td style="padding:1rem; text-align:center; font-weight:700;">Â¥{{ item.discounted_amount|floatformat:2 }}</td>
                            <td style="padding:1rem; text-align:center;">
                                <a href="{% url 'bookstore:cart_remove' item.book.isbn %}" onclick="return confirm('ç¡®å®šè¦ç§»é™¤ã€Š{{ item.book.title }}ã€‹å—ï¼Ÿ')" class="btn btn-danger" style="padding:0.4rem 0.8rem;">ç§»é™¤</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot>
                        <tr style="background: var(--secondary-bg);">
                            <td colspan="2" style="padding:1rem; text-align:left; font-weight:600;">åˆè®¡</td>
                            <td style="padding:1rem; text-align:center;">Â¥{{ original_total|floatformat:2 }}</td>
                            <td style="padding:1rem; text-align:center; font-weight:700; color:var(--error);">Â¥{{ discounted_total|floatformat:2 }}</td>
                            <td style="padding:1rem;"></td>
                        </tr>
                        {% if discount_amount > 0 %}
                        <tr>
                            <td colspan="4" style="padding:1rem; text-align:right; color:var(--success); font-weight:600;">å·²èŠ‚çœï¼š</td>
                            <td style="padding:1rem; text-align:center; color:var(--success); font-weight:700;">-Â¥{{ discount_amount|floatformat:2 }}</td>
                        </tr>
                        {% endif %}
                    </tfoot>
                </table>
            </div>
            {% else %}
            <div style="text-align:center; padding:3rem; color:var(--text-secondary);">
                <div style="font-size:3rem; margin-bottom:1rem;">ğŸ›ï¸</div>
                <div>è´­ç‰©è½¦ä¸ºç©ºï¼Œå¿«å»é€‰è´­å–œæ¬¢çš„ä¹¦å§ï¼</div>
                <p style="margin-top:1rem;"><a href="{% url 'bookstore:index' %}" class="btn btn-primary">å»é€›é€›</a></p>
            </div>
            {% endif %}
        </div>
    </div>

    {% if items %}
    <div style="display:flex; gap:1rem; justify-content:flex-end;">
        <a href="{% url 'bookstore:order_confirm' %}" class="btn btn-primary" style="padding:0.8rem 1.6rem;">ğŸš€ å»ç»“ç®—</a>
    </div>
    {% endif %}
</div>
{% endblock %}