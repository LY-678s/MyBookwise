{% extends "bookstore/base.html" %}
{% block content %}
<div class="container animate-fade-in">
    <!-- è¿”å›æŒ‰é’® -->
    <div style="margin-bottom: 2rem;">
        <a href="{% url 'bookstore:index' %}" class="btn btn-secondary">
            â† è¿”å›å›¾ä¹¦åˆ—è¡¨
        </a>
    </div>

    <div class="stacked" style="display:flex; flex-direction:column; gap:1.5rem;">
        <!-- å·¦ä¾§ï¼šå›¾ä¹¦å°é¢å’ŒåŸºæœ¬ä¿¡æ¯ -->
        <div>
            <!-- å›¾ä¹¦å°é¢ -->
            <div class="card" style="margin-bottom: 2rem;">
                <div style="position: relative;">
                    {% if book.coverimage %}
                        <img src="data:image/jpeg;base64,{{ book.coverimage|safe }}"
                             alt="{{ book.title }}"
                             style="width: 100%; height: 400px; object-fit: cover; border-radius: 12px 12px 0 0;">
                    {% else %}
                        <div style="width: 100%; height: 400px; background: linear-gradient(135deg, var(--accent-light) 0%, var(--accent) 100%); display: flex; align-items: center; justify-content: center; color: var(--text-primary); font-size: 5rem; border-radius: 12px 12px 0 0;">
                            ğŸ“–
                        </div>
                    {% endif %}

                </div>

                <div class="card-body">
                    <!-- ä»·æ ¼å’Œåº“å­˜ä¿¡æ¯ -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <div>
                            <span style="font-size: 2rem; font-weight: 700; color: var(--error);">
                                Â¥{{ book.price }}
                            </span>
                        </div>
                        <div style="text-align: right;">
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">åº“å­˜</div>
                            <div style="font-size: 1.2rem; font-weight: 600; color: {% if book.stockqty > 10 %}var(--success){% elif book.stockqty > 0 %}var(--warning){% else %}var(--error){% endif %}">
                                {{ book.stockqty }}
                            </div>
                        </div>
                    </div>

                    <!-- åŠ å…¥è´­ç‰©è½¦è¡¨å• -->
                    {% if request.session.customer_id %}
                    <form method="post" action="{% url 'bookstore:cart_add' book.isbn %}">
                        {% csrf_token %}
                        <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                            <div style="flex: 1;">
                                <label for="quantity" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">æ•°é‡</label>
                                <input type="number" name="quantity" id="quantity" value="1" min="1" max="{{ book.stockqty }}"
                                       class="form-control" style="text-align: center; font-size: 1.2rem; padding: 0.75rem;">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1.1rem;">
                            ğŸ›’ åŠ å…¥è´­ç‰©è½¦
                        </button>
                    </form>
                    {% else %}
                    <a href="{% url 'bookstore:login' %}" class="btn btn-secondary" style="width: 100%; text-align: center; padding: 1rem; font-size: 1.1rem;">
                        ğŸ” ç™»å½•åè´­ä¹°
                    </a>
                    {% endif %}
                </div>
            </div>

            <!-- å¿«é€Ÿä¿¡æ¯å¡ç‰‡ -->
            <div class="card">
                <div class="card-header">
                    <h4 style="margin: 0; color: var(--text-primary);">ğŸ“‹ å¿«é€Ÿä¿¡æ¯</h4>
                </div>
                <div class="card-body">
                    <div style="display: grid; gap: 1rem;">
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-secondary);">ISBN</span>
                            <span style="font-weight: 600;">{{ book.isbn }}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-secondary);">å‡ºç‰ˆç¤¾</span>
                            <span style="font-weight: 600;">{{ book.publisher|default:"æœªçŸ¥" }}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-secondary);">åº“å­˜ä½ç½®</span>
                            <span style="font-weight: 600;">{{ book.location|default:"æœªè®¾ç½®" }}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-secondary);">æœ€ä½åº“å­˜</span>
                            <span style="font-weight: 600;">{{ book.minstocklimit }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å³ä¾§ï¼šè¯¦ç»†ä¿¡æ¯ -->
        <div>
            <!-- å›¾ä¹¦æ ‡é¢˜å’Œå…³é”®è¯ -->
            <div class="card" style="margin-bottom: 2rem;">
                <div class="card-body">
                    <h1 style="color: var(--text-primary); margin: 0 0 1rem 0; font-size: 2rem; font-weight: 300;">
                        {{ book.title }}
                    </h1>

                    {% if book.keywords %}
                    <div style="margin-bottom: 1rem;">
                        <span style="background: var(--accent-light); color: var(--text-primary); padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.9rem;">
                            {{ book.keywords }}
                        </span>
                    </div>
                    {% endif %}

                    <!-- äº¤äº’æŒ‰é’®ç»„ -->
                    <div style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem;">
                        <button class="btn btn-secondary" onclick="toggleFavorite(this)"
                                style="padding: 0.5rem 1rem; font-size: 0.9rem;">
                            â¤ï¸ æ”¶è—
                        </button>
                        <button class="btn btn-secondary" onclick="shareBook()"
                                style="padding: 0.5rem 1rem; font-size: 0.9rem;">
                            ğŸ“¤ åˆ†äº«
                        </button>
                        <button class="btn btn-secondary" onclick="toggleDetails(this)"
                                style="padding: 0.5rem 1rem; font-size: 0.9rem;">
                            â„¹ï¸ è¯¦æƒ…
                        </button>
                    </div>

                    <!-- è¯¦ç»†ä¿¡æ¯ï¼ˆé»˜è®¤éšè—ï¼‰ -->
                    <div id="book-details" style="display: none; padding: 1rem; background: var(--secondary-bg); border-radius: 8px; margin-top: 1rem;">
                        <h4 style="margin: 0 0 1rem 0; color: var(--text-primary);">ğŸ“– å›¾ä¹¦è¯¦æƒ…</h4>
                        <div style="color: var(--text-secondary); line-height: 1.6;">
                            <p><strong>ISBN:</strong> {{ book.isbn }}</p>
                            <p><strong>å‡ºç‰ˆç¤¾:</strong> {{ book.publisher|default:"æœªçŸ¥" }}</p>
                            <p><strong>ä»·æ ¼:</strong> Â¥{{ book.price }}</p>
                            <p><strong>åº“å­˜:</strong> {{ book.stockqty }} æœ¬</p>
                            <p><strong>åº“å­˜ä½ç½®:</strong> {{ book.location|default:"æœªè®¾ç½®" }}</p>
                            <p><strong>æœ€ä½åº“å­˜é¢„è­¦:</strong> {{ book.minstocklimit }} æœ¬</p>
                            {% if book.keywords %}
                            <p><strong>å…³é”®è¯:</strong> {{ book.keywords }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ¨èå›¾ä¹¦ -->
            <div class="card">
                <div class="card-header">
                    <h4 style="margin: 0; color: var(--text-primary);">ğŸ“š ç›¸å…³æ¨è</h4>
                </div>
                <div class="card-body">
                    <div style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ”„</div>
                        <p>æ­£åœ¨åŠ è½½ç›¸å…³æ¨è...</p>
                        <small>åŸºäºå½“å‰å›¾ä¹¦çš„å…³é”®è¯å’Œå‡ºç‰ˆç¤¾</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// æ”¶è—åŠŸèƒ½
function toggleFavorite(btn) {
    const isFavorite = btn.innerHTML.includes('â¤ï¸');
    btn.innerHTML = isFavorite ? 'ğŸ¤ æ”¶è—' : 'â¤ï¸ æ”¶è—';
    btn.style.background = isFavorite ? 'var(--secondary-bg)' : 'linear-gradient(135deg, #ff6b9d 0%, #c44569 100%)';
    btn.style.color = isFavorite ? 'var(--text-primary)' : 'white';
}

// åˆ†äº«åŠŸèƒ½
function shareBook() {
    const url = window.location.href;
    const title = document.querySelector('h1').textContent.trim();

    if (navigator.share) {
        navigator.share({
            title: title,
            url: url
        });
    } else {
        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        navigator.clipboard.writeText(url).then(() => {
            alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
        });
    }
}

// è¯¦æƒ…åˆ‡æ¢
function toggleDetails(btn) {
    const details = document.getElementById('book-details');
    const isVisible = details.style.display !== 'none';

    details.style.display = isVisible ? 'none' : 'block';
    btn.innerHTML = isVisible ? 'â„¹ï¸ è¯¦æƒ…' : 'ğŸ”½ æ”¶èµ·';
}

// æ·»åŠ ä¸€äº›åŠ¨æ€æ•ˆæœ
document.addEventListener('DOMContentLoaded', function() {
    // ä¸ºæŒ‰é’®æ·»åŠ æ‚¬æµ®æ•ˆæœ
    const buttons = document.querySelectorAll('.btn');
    buttons.forEach(btn => {
        btn.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px) scale(1.02)';
        });

        btn.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
    });

    // ä¸ºå¡ç‰‡æ·»åŠ å¾®åŠ¨ç”»
    const cards = document.querySelectorAll('.card');
    cards.forEach((card, index) => {
        card.style.animationDelay = `${index * 100}ms`;
    });
});
</script>

<style>
/* è‡ªå®šä¹‰å›¾ä¹¦è¯¦æƒ…é¡µæ ·å¼ï¼ˆå·²ç®€åŒ–ä¸ºå•åˆ—ï¼‰ */
.stacked { display:flex; flex-direction:column; gap:1rem; }

/* æŒ‰é’®æ‚¬æµ®æ•ˆæœï¼ˆä¿ç•™å¾®äº¤äº’ï¼‰ */
.btn {
    transition: all 0.2s ease !important;
}

.btn:hover {
    transform: translateY(-2px) scale(1.02) !important;
}

/* è¯¦æƒ…é¢æ¿åŠ¨ç”» */
#book-details {
    transition: all 0.25s ease;
}

/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 768px) {
    .stacked { gap:0.8rem; }
    .card-body { padding:1rem; }
}
</style>
{% endblock %}