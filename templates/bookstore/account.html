{% extends "bookstore/base.html" %}

{% block title %}æˆ‘çš„è´¦æˆ· - MyBookwise{% endblock %}

{% block content %}
<h2>æˆ‘çš„è´¦æˆ·</h2>

<div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
    <h3 style="margin-top: 0;">è´¦æˆ·ä¿¡æ¯</h3>
    <table style="width: 100%; border: none;">
        <tr>
            <td style="border: none; padding: 0.5rem 0;"><strong>ç”¨æˆ·åï¼š</strong></td>
            <td style="border: none; padding: 0.5rem 0;">{{ customer.username }} ({{ customer.name }})</td>
        </tr>
        <tr>
            <td style="border: none; padding: 0.5rem 0;"><strong>ä¿¡ç”¨ç­‰çº§ï¼š</strong></td>
            <td style="border: none; padding: 0.5rem 0;">
                {{ customer.levelid.levelid }}çº§ 
                ({{ discount_percent|floatformat:0 }}% ä¼˜æƒ )
            </td>
        </tr>
        <tr>
            <td style="border: none; padding: 0.5rem 0;"><strong>è´¦æˆ·ä½™é¢ï¼š</strong></td>
            <td style="border: none; padding: 0.5rem 0; {% if customer.balance < 0 %}color: #e74c3c;{% else %}color: #27ae60;{% endif %} font-size: 1.3rem; font-weight: bold;">
                Â¥{{ customer.balance }}
            </td>
        </tr>
        <tr>
            <td style="border: none; padding: 0.5rem 0;"><strong>å½“å‰é€æ”¯ï¼š</strong></td>
            <td style="border: none; padding: 0.5rem 0; {% if customer.currentoverdraft > 0 %}color: #e74c3c;{% endif %}">
                Â¥{{ customer.currentoverdraft }}
                {% if customer.levelid.canoverdraft %}
                    / Â¥{{ customer.overdraftlimit }} (å¯ç”¨é¢åº¦)
                {% endif %}
            </td>
        </tr>
        <tr>
            <td style="border: none; padding: 0.5rem 0;"><strong>ç´¯è®¡æ¶ˆè´¹ï¼š</strong></td>
            <td style="border: none; padding: 0.5rem 0;">Â¥{{ customer.totalspent }}</td>
        </tr>
    </table>
</div>

<!-- å……å€¼åŠŸèƒ½ -->
<div style="background: white; padding: 1.5rem; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 1.5rem;">
    <h3 style="margin-top: 0;">ğŸ’° è´¦æˆ·å……å€¼</h3>
    <form method="post" style="display: flex; gap: 1rem; align-items: center;">
        {% csrf_token %}
        <label for="amount">å……å€¼é‡‘é¢ï¼š</label>
        <input type="number" name="amount" id="amount" step="0.01" min="0.01" 
               placeholder="è¾“å…¥é‡‘é¢" 
               style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; width: 200px;"
               required>
        <button type="submit" class="btn btn-success">ç¡®è®¤å……å€¼</button>
    </form>
    <p style="color: #7f8c8d; font-size: 0.9rem; margin-top: 0.5rem;">
        æç¤ºï¼šå……å€¼åä½™é¢ç«‹å³åˆ°è´¦
    </p>
</div>

<!-- å¿è¿˜é€æ”¯ -->
{% if customer.currentoverdraft > 0 %}
<div style="background: #fff3cd; padding: 1.5rem; border: 1px solid #ffeaa7; border-radius: 8px; margin-bottom: 1.5rem;">
    <h3 style="margin-top: 0; color: #856404;">ğŸ’³ å¿è¿˜é€æ”¯</h3>
    <p>å½“å‰é€æ”¯é‡‘é¢ï¼š<strong style="color: #e74c3c; font-size: 1.2rem;">Â¥{{ customer.currentoverdraft }}</strong></p>
    <p style="color: #856404; font-size: 0.9rem;">
        åŒ…æ‹¬ï¼šæœªä»˜æ¬¾è®¢å•å ç”¨çš„é¢åº¦ + è´Ÿä½™é¢
    </p>
    <form method="post" action="{% url 'bookstore:repay_overdraft' %}">
        {% csrf_token %}
        <button type="submit" class="btn btn-warning" 
                onclick="return confirm('âš ï¸ æ­¤æ“ä½œå°†æ”¯ä»˜æ‰€æœ‰æœªä»˜æ¬¾è®¢å•å¹¶è¡¥è¶³è´Ÿä½™é¢ï¼\n\nå¿è¿˜é‡‘é¢ï¼šÂ¥{{ customer.currentoverdraft }}\n\nå¿è¿˜åæ‚¨çš„ç´¯è®¡æ¶ˆè´¹å°†å¢åŠ ï¼Œå¯èƒ½ä¼šæå‡ä¿¡ç”¨ç­‰çº§ã€‚\n\nç¡®å®šç»§ç»­å—ï¼Ÿ')">
            ğŸ’° å¿è¿˜å…¨éƒ¨é€æ”¯ï¼ˆæ”¯ä»˜æ‰€æœ‰æœªä»˜æ¬¾è®¢å•ï¼‰
        </button>
    </form>
    <p style="color: #856404; font-size: 0.9rem; margin-top: 0.5rem;">
        âœ¨ æç¤ºï¼šå¿è¿˜é€æ”¯ä¼šæ”¯ä»˜æ‰€æœ‰æœªä»˜æ¬¾è®¢å•å¹¶è¡¥è¶³è´Ÿä½™é¢ï¼Œç´¯è®¡æ¶ˆè´¹ä¹Ÿä¼šç›¸åº”å¢åŠ ï¼Œå¯èƒ½æå‡ä¿¡ç”¨ç­‰çº§ï¼
    </p>
</div>
{% endif %}

<!-- ä¿¡ç”¨ç­‰çº§è¯´æ˜ -->
<div style="background: #e8f5e9; padding: 1.5rem; border: 1px solid #c8e6c9; border-radius: 8px;">
    <h3 style="margin-top: 0; color: #2e7d32;">ğŸ–ï¸ ä¿¡ç”¨ç­‰çº§è¯´æ˜</h3>
    <table style="width: 100%; font-size: 0.9rem;">
        <thead>
            <tr>
                <th>ç­‰çº§</th>
                <th>ç´¯è®¡æ¶ˆè´¹è¦æ±‚</th>
                <th>æŠ˜æ‰£ç‡</th>
                <th>é€æ”¯é¢åº¦</th>
            </tr>
        </thead>
        <tbody>
            <tr {% if customer.levelid.levelid == 1 %}style="background: #fff9c4;"{% endif %}>
                <td>1çº§</td>
                <td>< Â¥1000</td>
                <td>0.9 (10%ä¼˜æƒ )</td>
                <td>ä¸å¯é€æ”¯</td>
            </tr>
            <tr {% if customer.levelid.levelid == 2 %}style="background: #fff9c4;"{% endif %}>
                <td>2çº§</td>
                <td>â‰¥ Â¥1000</td>
                <td>0.85 (15%ä¼˜æƒ )</td>
                <td>ä¸å¯é€æ”¯</td>
            </tr>
            <tr {% if customer.levelid.levelid == 3 %}style="background: #fff9c4;"{% endif %}>
                <td>3çº§</td>
                <td>â‰¥ Â¥2000</td>
                <td>0.85 (15%ä¼˜æƒ )</td>
                <td>Â¥500</td>
            </tr>
            <tr {% if customer.levelid.levelid == 4 %}style="background: #fff9c4;"{% endif %}>
                <td>4çº§</td>
                <td>â‰¥ Â¥5000</td>
                <td>0.8 (20%ä¼˜æƒ )</td>
                <td>Â¥1000</td>
            </tr>
            <tr {% if customer.levelid.levelid == 5 %}style="background: #fff9c4;"{% endif %}>
                <td>5çº§</td>
                <td>â‰¥ Â¥10000</td>
                <td>0.75 (25%ä¼˜æƒ )</td>
                <td>å‡ ä¹æ— é™</td>
            </tr>
        </tbody>
    </table>
    <p style="color: #2e7d32; margin-top: 1rem; margin-bottom: 0;">
        æ‚¨å½“å‰æ˜¯ <strong>{{ customer.levelid.levelid }}çº§ä¼šå‘˜</strong>ï¼Œ
        ç´¯è®¡æ¶ˆè´¹ <strong>Â¥{{ customer.totalspent }}</strong>
        {% if customer.levelid.levelid < 5 %}
            ï¼Œè·ç¦»ä¸‹ä¸€çº§è¿˜éœ€ Â¥{{ next_level_amount|default:"è®¡ç®—ä¸­..." }}
        {% endif %}
    </p>
</div>

<div style="margin-top: 2rem;">
    <a href="{% url 'bookstore:order_list' %}" class="btn">è¿”å›è®¢å•åˆ—è¡¨</a>
</div>

{% endblock %}

