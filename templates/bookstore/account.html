{% extends "bookstore/base.html" %}

{% block title %}æˆ‘çš„è´¦æˆ· - MyBookwise{% endblock %}

{% block content %}
<div class="container animate-fade-in">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div style="text-align: center; margin-bottom: 3rem;">
        <h1 style="color: var(--text-primary); font-size: 2.5rem; font-weight: 300; margin-bottom: 0.5rem;">
            ğŸ‘¤ æˆ‘çš„è´¦æˆ·
        </h1>
        <p style="color: var(--text-secondary); font-size: 1.1rem;">
            ç®¡ç†æ‚¨çš„ä¸ªäººä¿¡æ¯å’Œè´¦æˆ·è®¾ç½®
        </p>
    </div>

    <div class="stacked" style="display:flex; flex-direction:column; gap:1.5rem;">
        <!-- åŸºæœ¬ä¿¡æ¯å¡ç‰‡ -->
        <div class="card">
            <div class="card-header">
                <h3 style="margin:0; color:var(--text-primary); display:flex; align-items:center; gap:0.5rem;">
                    <span>ğŸ“‹</span> åŸºæœ¬ä¿¡æ¯
                </h3>
            </div>
            <div class="card-body">
                <div style="display:grid; gap:0.8rem;">
                    <div style="display:flex; justify-content:space-between;">
                        <span style="color:var(--text-secondary);">ç”¨æˆ·å</span>
                        <span style="font-weight:600;">{{ customer.username }}</span>
                    </div>
                    <div style="display:flex; justify-content:space-between;">
                        <span style="color:var(--text-secondary);">å§“å</span>
                        <span style="font-weight:600;">{{ customer.name }}</span>
                    </div>
                    <div style="display:flex; justify-content:space-between;">
                        <span style="color:var(--text-secondary);">é‚®ç®±</span>
                        <span style="font-weight:600;">{{ customer.email|default:"æœªè®¾ç½®" }}</span>
                    </div>
                    <div style="display:flex; justify-content:space-between;">
                        <span style="color:var(--text-secondary);">åœ°å€</span>
                        <span style="font-weight:600;">{{ customer.address|default:"æœªè®¾ç½®" }}</span>
                    </div>
                    <div style="display:flex; justify-content:space-between;">
                        <span style="color:var(--text-secondary);">æ³¨å†Œæ—¶é—´</span>
                        <span style="font-weight:600;">{{ customer.registerdate|date:"Y-m-d" }}</span>
                    </div>
                    <div style="margin-top:0.8rem; display:flex; gap:0.5rem;">
                        <button class="btn btn-secondary" onclick="toggleEditMode()" style="margin-right:auto;">âœï¸ ç¼–è¾‘ä¿¡æ¯</button>
                        <a href="#change-password" class="btn btn-secondary">ğŸ”’ ä¿®æ”¹å¯†ç </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä½™é¢å¡ç‰‡ -->
        <div class="card">
            <div class="card-header">
                <h3 style="margin:0; color:var(--text-primary);">ğŸ’° è´¦æˆ·ä½™é¢</h3>
            </div>
            <div class="card-body">
                <div style="display:flex; flex-direction:column; gap:0.5rem;">
                    <div style="font-size:2.4rem; font-weight:300; color:{% if customer.balance < 0 %}var(--error){% else %}var(--success){% endif %};">
                        Â¥{{ customer.balance }}
                    </div>
                    <div style="color:var(--text-secondary);">
                        {% if customer.balance < 0 %}æ¬ æ¬¾é‡‘é¢{% else %}å¯ç”¨ä½™é¢{% endif %}
                    </div>
                    <form method="post" style="margin-top:0.5rem; display:flex; gap:0.5rem;">
                        {% csrf_token %}
                        <input type="number" name="amount" step="0.01" min="0.01" placeholder="å……å€¼é‡‘é¢" class="form-control" style="max-width:220px;">
                        <button type="submit" class="btn btn-success">å……å€¼</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- ä¿¡ç”¨ä¿¡æ¯å¡ç‰‡ -->
        <div class="card">
            <div class="card-header">
                <h3 style="margin:0; color:var(--text-primary);">ğŸ–ï¸ ä¿¡ç”¨ä¿¡æ¯</h3>
            </div>
            <div class="card-body">
                <div style="display:grid; gap:0.8rem;">
                    <div style="display:flex; justify-content:space-between;">
                        <span style="color:var(--text-secondary);">å½“å‰ç­‰çº§</span>
                        <span style="font-weight:600; color:var(--accent);">{{ customer.levelid.levelid }}çº§</span>
                    </div>
                    <div style="display:flex; justify-content:space-between;">
                        <span style="color:var(--text-secondary);">ç´¯è®¡æ¶ˆè´¹</span>
                        <span style="font-weight:600;">Â¥{{ customer.totalspent }}</span>
                    </div>
                    {% if customer.levelid.canusecredit %}
                    <div style="display:flex; justify-content:space-between;">
                        <span style="color:var(--text-secondary);">å¯ç”¨ä¿¡ç”¨é¢åº¦</span>
                        <span style="font-weight:600;">Â¥{{ customer.creditlimit|add:"-"|add:customer.usedcredit|floatformat:2 }}</span>
                    </div>
                        {% if customer.usedcredit > 0 %}
                        <div style="background: linear-gradient(135deg, var(--warning) 0%, #F4C2A1 100%); padding:1rem; border-radius:8px;">
                            <div style="display:flex; justify-content:space-between;">
                                <span style="color:#8B5A2B; font-weight:600;">å¾…è¿˜æ¬¾</span>
                                <span style="color:#8B5A2B; font-weight:700;">Â¥{{ customer.usedcredit }}</span>
                            </div>
                            <form method="post" action="{% url 'bookstore:repay_overdraft' %}" style="margin-top:0.5rem;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-warning" style="width:100%;">ğŸ’° å…¨éƒ¨è¿˜æ¬¾</button>
                            </form>
                        </div>
                        {% endif %}
                    {% else %}
                    <div style="color:var(--text-secondary); font-style:italic;">ğŸ¯ ç»§ç»­è´­ç‰©æå‡ç­‰çº§ï¼Œè§£é”ä¿¡ç”¨æ”¯ä»˜åŠŸèƒ½</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- å¿«æ·æ“ä½œ -->
        <div class="card">
            <div class="card-header">
                <h3 style="margin:0; color:var(--text-primary);">ğŸš€ å¿«æ·æ“ä½œ</h3>
            </div>
            <div class="card-body">
                <div style="display:flex; gap:0.75rem; flex-wrap:wrap;">
                    <a href="{% url 'bookstore:order_list' %}" class="btn btn-primary">ğŸ“¦ æˆ‘çš„è®¢å•</a>
                    <a href="{% url 'bookstore:cart_detail' %}" class="btn btn-secondary">ğŸ›’ è´­ç‰©è½¦</a>
                    <a href="{% url 'bookstore:index' %}" class="btn btn-secondary">ğŸ“š ç»§ç»­è´­ç‰©</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¿¡ç”¨ç­‰çº§è¯´æ˜ -->
    <div class="card" style="margin-top: 3rem;">
        <div class="card-header">
            <h3 style="margin: 0; color: var(--text-primary);">ğŸ–ï¸ ä¿¡ç”¨ç­‰çº§è¯´æ˜</h3>
        </div>
        <div class="card-body">
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: var(--secondary-bg);">
                            <th style="padding: 1rem; text-align: left; border-bottom: 2px solid var(--border); color: var(--text-primary);">ç­‰çº§</th>
                            <th style="padding: 1rem; text-align: left; border-bottom: 2px solid var(--border); color: var(--text-primary);">æ¶ˆè´¹è¦æ±‚</th>
                            <th style="padding: 1rem; text-align: left; border-bottom: 2px solid var(--border); color: var(--text-primary);">æŠ˜æ‰£ç‡</th>
                            <th style="padding: 1rem; text-align: left; border-bottom: 2px solid var(--border); color: var(--text-primary);">ä¿¡ç”¨é¢åº¦</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr {% if customer.levelid.levelid == 1 %}style="background: var(--accent-light);"{% endif %}>
                            <td style="padding: 1rem; border-bottom: 1px solid var(--border);">1çº§</td>
                            <td style="padding: 1rem; border-bottom: 1px solid var(--border);">< Â¥1000</td>
                            <td style="padding: 1rem; border-bottom: 1px solid var(--border);">9æŠ˜</td>
                            <td style="padding: 1rem; border-bottom: 1px solid var(--border);">ä¸å¯é€æ”¯</td>
                        </tr>
                        <tr {% if customer.levelid.levelid == 2 %}style="background: var(--accent-light);"{% endif %}>
                            <td style="padding: 1rem; border-bottom: 1px solid var(--border);">2çº§</td>
                            <td style="padding: 1rem; border-bottom: 1px solid var(--border);">â‰¥ Â¥1000</td>
                            <td style="padding: 1rem; border-bottom: 1px solid var(--border);">8.5æŠ˜</td>
                            <td style="padding: 1rem; border-bottom: 1px solid var(--border);">ä¸å¯é€æ”¯</td>
                        </tr>
                        <tr {% if customer.levelid.levelid == 3 %}style="background: var(--accent-light);"{% endif %}>
                            <td style="padding: 1rem; border-bottom: 1px solid var(--border);">3çº§</td>
                            <td style="padding: 1rem; border-bottom: 1px solid var(--border);">â‰¥ Â¥2000</td>
                            <td style="padding: 1rem; border-bottom: 1px solid var(--border);">8.5æŠ˜</td>
                            <td style="padding: 1rem; border-bottom: 1px solid var(--border);">Â¥500</td>
                        </tr>
                        <tr {% if customer.levelid.levelid == 4 %}style="background: var(--accent-light);"{% endif %}>
                            <td style="padding: 1rem; border-bottom: 1px solid var(--border);">4çº§</td>
                            <td style="padding: 1rem; border-bottom: 1px solid var(--border);">â‰¥ Â¥5000</td>
                            <td style="padding: 1rem; border-bottom: 1px solid var(--border);">8æŠ˜</td>
                            <td style="padding: 1rem; border-bottom: 1px solid var(--border);">Â¥1000</td>
                        </tr>
                        <tr {% if customer.levelid.levelid == 5 %}style="background: var(--accent-light);"{% endif %}>
                            <td style="padding: 1rem; border-bottom: 1px solid var(--border);">5çº§</td>
                            <td style="padding: 1rem; border-bottom: 1px solid var(--border);">â‰¥ Â¥10000</td>
                            <td style="padding: 1rem; border-bottom: 1px solid var(--border);">7.5æŠ˜</td>
                            <td style="padding: 1rem; border-bottom: 1px solid var(--border);">å‡ ä¹æ— é™</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div style="margin-top: 1.5rem; padding: 1rem; background: var(--secondary-bg); border-radius: 8px;">
                <p style="margin: 0; color: var(--text-primary);">
                    ğŸ¯ æ‚¨å½“å‰æ˜¯ <strong>{{ customer.levelid.levelid }}çº§ä¼šå‘˜</strong>ï¼Œ
                    ç´¯è®¡æ¶ˆè´¹ <strong>Â¥{{ customer.totalspent }}</strong>
                    {% if customer.levelid.levelid < 5 %}
                        ï¼Œè·ç¦»ä¸‹ä¸€çº§è¿˜éœ€ <strong>Â¥{{ next_level_amount|default:"è®¡ç®—ä¸­..." }}</strong>
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
</div>

<script>
function toggleEditMode() {
    const display = document.getElementById('info-display');
    const edit = document.getElementById('info-edit');

    if (display.style.display !== 'none') {
        display.style.display = 'none';
        edit.style.display = 'block';
    } else {
        display.style.display = 'block';
        edit.style.display = 'none';
    }
}

// é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    // ä¸ºæŒ‰é’®æ·»åŠ åŠ¨ç”»æ•ˆæœ
    const buttons = document.querySelectorAll('.btn');
    buttons.forEach(btn => {
        btn.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px) scale(1.02)';
        });

        btn.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
    });
});
</script>

<style>
/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 768px) {
    .grid-2 {
        grid-template-columns: 1fr;
    }

    .card-body table {
        font-size: 0.8rem;
    }

    .card-body table th,
    .card-body table td {
        padding: 0.5rem;
    }
}
</style>

 

<div style="margin-top: 2rem;">
    <a href="{% url 'bookstore:order_list' %}" class="btn">è¿”å›è®¢å•åˆ—è¡¨</a>
</div>

{% endblock %}

